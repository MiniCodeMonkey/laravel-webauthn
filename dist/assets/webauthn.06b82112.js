const b=()=>(window==null?void 0:window.PublicKeyCredential)!==void 0&&typeof window.PublicKeyCredential=="function",f=n=>{const e=n.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4,t=e.padEnd(e.length+r,"="),i=atob(t),o=new ArrayBuffer(i.length),l=new Uint8Array(o);for(let s=0;s<i.length;s++)l[s]=i.charCodeAt(s);return o},h=n=>{const{id:e}=n;return{...n,id:f(e)}};class y{constructor(){this.reset()}createNewAbortSignal(){return this.controller&&this.controller.abort(),this.controller=new AbortController,this.controller.signal}reset(){this.controller=void 0}}const u=new y,c=n=>{const e=new Uint8Array(n);let r="";for(const i of e)r+=String.fromCharCode(i);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},m=n=>new TextDecoder("utf-8").decode(n),w=n=>{const{id:e,rawId:r,response:t,type:i}=n,o={id:e,rawId:c(r),response:{clientDataJSON:c(t.clientDataJSON)},type:i,clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:n.authenticatorAttachment};return t.attestationObject!==void 0&&(o.response.attestationObject=c(t.attestationObject)),t.authenticatorData!==void 0&&(o.response.authenticatorData=c(t.authenticatorData)),t.signature!==void 0&&(o.response.signature=c(t.signature)),t.userHandle&&(o.response.userHandle=m(t.userHandle)),o},A=n=>n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n),a={Abort:"AbortError",Constraint:"ConstraintError",InvalidState:"InvalidStateError",NotAllowed:"NotAllowedError",Security:"SecurityError",Type:"TypeError",Unknown:"UnknownError"},p=(n,e)=>{var t;const{publicKey:r}=e;if(!r)throw new Error("options param is missing the required publicKey property");if(n.name===a.Abort&&e.signal===new AbortController().signal)return{name:a.Abort,default:"Authentication ceremony was sent an abort signal."};if(n.name===a.NotAllowed)return(t=r.allowedCredentials)!=null&&t.length?{name:`${a.NotAllowed}_none_registered`,default:"No available authenticator recognized any of the allowed credentials."}:{name:a.NotAllowed,default:"User clicked cancel, or the authentication ceremony timed out."};if(n.name===a.Security){const i=window.location.hostname;if(!A(i))return{name:a.Security,default:`${window.location.hostname} is an invalid domain.`};if(r.rpId!==i)return{name:a.Security,default:`The RP ID "${r.rpId}" is invalid for this domain.`}}return{name:a.Unknown,default:"The authenticator was unable to process your request."}},C=n=>new TextEncoder().encode(n),S=n=>{if(!n.response.getTransports().includes("internal"))return"Security key";const e=navigator.userAgent,r=navigator.platform,t=["Macintosh","MacIntel","MacPPC","Mac68K"],i=["Win32","Win64","Windows","WinCE"],o=["iPhone","iPad","iPod"];return t.includes(r)?"macOS Computer":o.includes(r)?"iOS Phone":i.includes(r)?"Windows Computer":/Android/.test(e)?"Android Phone":/Linux/.test(r)?"Linux Computer":"Unknown Device Type"};class E{constructor(e=null){this.notifyCallback=e}registerNotifyCallback(e){return this.notifyCallback=e,this}async register(e,r){var l;if(!this.supported())throw new Error("WebAuthn is not supported in this browser.");const t=Object.assign({},e);t.challenge=f(e.challenge),t.user.id=C(e.user.id),t.excludeCredentials=(l=e.excludeCredentials)==null?void 0:l.map(h);const i={publicKey:t,signal:u.createNewAbortSignal()};let o;try{o=await navigator.credentials.create(i)}catch(s){const{name:d,default:g}=p(s,i);this._notify(d,g);return}finally{u.reset()}if(!o){this._notify(a.Unknown,"Authentication was not completed.");return}r(w(o),S(o))}async sign(e,r){if(!this.supported())throw new Error("WebAuthn is not supported in this browser.");const t=Object.assign({},e);t.challenge=f(e.challenge),e.allowCredentials&&(t.allowCredentials=e.allowCredentials.map(h));const i={publicKey:t,signal:u.createNewAbortSignal()};let o;try{o=await navigator.credentials.get(i)}catch(l){const{name:s,default:d}=p(l,i);this._notify(s,d);return}finally{u.reset()}if(!o){this._notify(a.Unknown,"Authentication was not completed.");return}r(w(o))}supported(){return b()}notSupportedType(){return!window.isSecureContext&&window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"?"notSecured":"notSupported"}_notify(e,r){this.notifyCallback&&this.notifyCallback(e,r)}}window.WebAuthn=E;
