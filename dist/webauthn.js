(()=>{"use strict";function e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var t=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e(this,t),this.notifyCallback=n}var i,r,o;return i=t,(r=[{key:"registerNotifyCallback",value:function(e){return this.notifyCallback=e,this}},{key:"register",value:function(e,n){var t=this,i=Object.assign({},e);i.user.id=this._bufferDecode(e.user.id),i.challenge=this._bufferDecode(this._base64Decode(e.challenge)),e.excludeCredentials&&(i.excludeCredentials=this._credentialDecode(e.excludeCredentials)),navigator.credentials.create({publicKey:i}).then((function(e){t._onRegister(e,n)}),(function(e){t._notify(e.name,e.message)})).catch((function(e){t._notify("unknown",e.message)}))}},{key:"sign",value:function(e,n){var t=this,i=Object.assign({},e);i.challenge=this._bufferDecode(this._base64Decode(e.challenge)),e.allowCredentials&&(i.allowCredentials=this._credentialDecode(e.allowCredentials)),navigator.credentials.get({publicKey:i}).then((function(e){t._onSign(e,n)}),(function(e){t._notify(e.name,e.message)})).catch((function(e){t._notify("unknown",e.message)}))}},{key:"supported",value:function(){return!(void 0===window.PublicKeyCredential||"function"!=typeof window.PublicKeyCredential||"function"!=typeof window.PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable)}},{key:"notSupportedType",value:function(){return window.isSecureContext||"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"notSupported":"notSecured"}},{key:"_bufferDecode",value:function(e){var n=window.atob(e);return Uint8Array.from(n,(function(e){return e.charCodeAt(0)}))}},{key:"_bufferEncode",value:function(e){return window.btoa(String.fromCharCode.apply(null,new Uint8Array(e)))}},{key:"_base64Decode",value:function(e){var n=(e=e.replace(/-/g,"+").replace(/_/g,"/")).length%4;if(n){if(1===n)throw new Error("InvalidLengthError: Input base64url string is the wrong length to determine padding.");e+=new Array(5-n).join("=")}return e}},{key:"_credentialDecode",value:function(e){var n=this;return e.map((function(e){return{id:n._bufferDecode(n._base64Decode(e.id)),type:e.type,transports:e.transports}}))}},{key:"_notify",value:function(e,n){this.notifyCallback&&this.notifyCallback(e,n)}},{key:"_onRegister",value:function(e,n){n({id:e.id,type:e.type,rawId:this._bufferEncode(e.rawId),response:{clientDataJSON:this._bufferEncode(e.response.clientDataJSON),attestationObject:this._bufferEncode(e.response.attestationObject)}},this._guessDeviceName(e))}},{key:"_onSign",value:function(e,n){n({id:e.id,type:e.type,rawId:this._bufferEncode(e.rawId),response:{authenticatorData:this._bufferEncode(e.response.authenticatorData),clientDataJSON:this._bufferEncode(e.response.clientDataJSON),signature:this._bufferEncode(e.response.signature),userHandle:e.response.userHandle?this._bufferEncode(e.response.userHandle):null}})}},{key:"_guessDeviceName",value:function(e){if(!e.response.getTransports().includes("internal"))return"Security key";var n=navigator.userAgent,t=navigator.platform;return["Macintosh","MacIntel","MacPPC","Mac68K"].includes(t)?"macOS Computer":["iPhone","iPad","iPod"].includes(t)?"iOS Phone":["Win32","Win64","Windows","WinCE"].includes(t)?"Windows Computer":/Android/.test(n)?"Android Phone":/Linux/.test(t)?"Linux Computer":"Unknown Device Type"}}])&&n(i.prototype,r),o&&n(i,o),Object.defineProperty(i,"prototype",{writable:!1}),t}();window.WebAuthn=t})();